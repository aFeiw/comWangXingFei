import{_ as s,c as n,o as a,a as l}from"./app.2c0d76d1.js";const b=JSON.parse('{"title":"\u7F51\u7EDC\u8BF7\u6C42","description":"","frontmatter":{},"headers":[{"level":2,"title":"HTTP \u8BF7\u6C42","slug":"http-\u8BF7\u6C42","link":"#http-\u8BF7\u6C42","children":[{"level":3,"title":"1. \u4F7F\u7528 http \u5305","slug":"_1-\u4F7F\u7528-http-\u5305","link":"#_1-\u4F7F\u7528-http-\u5305","children":[]},{"level":3,"title":"2. \u4F7F\u7528 Dio \u5305","slug":"_2-\u4F7F\u7528-dio-\u5305","link":"#_2-\u4F7F\u7528-dio-\u5305","children":[]}]},{"level":2,"title":"\u72B6\u6001\u7BA1\u7406\u4E2D\u7684\u7F51\u7EDC\u8BF7\u6C42","slug":"\u72B6\u6001\u7BA1\u7406\u4E2D\u7684\u7F51\u7EDC\u8BF7\u6C42","link":"#\u72B6\u6001\u7BA1\u7406\u4E2D\u7684\u7F51\u7EDC\u8BF7\u6C42","children":[{"level":3,"title":"1. \u4F7F\u7528 Provider","slug":"_1-\u4F7F\u7528-provider","link":"#_1-\u4F7F\u7528-provider","children":[]},{"level":3,"title":"2. \u4F7F\u7528 Riverpod","slug":"_2-\u4F7F\u7528-riverpod","link":"#_2-\u4F7F\u7528-riverpod","children":[]}]},{"level":2,"title":"WebSocket \u8FDE\u63A5","slug":"websocket-\u8FDE\u63A5","link":"#websocket-\u8FDE\u63A5","children":[]},{"level":2,"title":"\u7F13\u5B58\u548C\u79BB\u7EBF\u652F\u6301","slug":"\u7F13\u5B58\u548C\u79BB\u7EBF\u652F\u6301","link":"#\u7F13\u5B58\u548C\u79BB\u7EBF\u652F\u6301","children":[]},{"level":2,"title":"\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236","slug":"\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236","link":"#\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236","children":[]},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}],"relativePath":"frontend/CrossPlatform/http-requests.md","lastUpdated":1754012005000}'),p={name:"frontend/CrossPlatform/http-requests.md"},o=l(`<h1 id="\u7F51\u7EDC\u8BF7\u6C42" tabindex="-1">\u7F51\u7EDC\u8BF7\u6C42 <a class="header-anchor" href="#\u7F51\u7EDC\u8BF7\u6C42" aria-hidden="true">#</a></h1><p>Flutter \u63D0\u4F9B\u4E86\u591A\u79CD\u65B9\u5F0F\u8FDB\u884C\u7F51\u7EDC\u8BF7\u6C42\uFF0C\u5305\u62EC HTTP \u8BF7\u6C42\u3001WebSocket \u8FDE\u63A5\u7B49\u3002</p><h2 id="http-\u8BF7\u6C42" tabindex="-1">HTTP \u8BF7\u6C42 <a class="header-anchor" href="#http-\u8BF7\u6C42" aria-hidden="true">#</a></h2><h3 id="_1-\u4F7F\u7528-http-\u5305" tabindex="-1">1. \u4F7F\u7528 http \u5305 <a class="header-anchor" href="#_1-\u4F7F\u7528-http-\u5305" aria-hidden="true">#</a></h3><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;package:http/http.dart&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">as</span><span style="color:#C9D1D9;"> http;</span></span>
<span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;dart:convert&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> baseUrl </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;https://jsonplaceholder.typicode.com&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// GET \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt; </span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> http.</span><span style="color:#FF7B72;">get</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">Uri</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">parse</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#79C0FF;">baseUrl</span><span style="color:#A5D6FF;">/posts&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">        headers</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#A5D6FF;">&#39;Content-Type&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;application/json&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (response.statusCode </span><span style="color:#FF7B72;">==</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">200</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">dynamic</span><span style="color:#C9D1D9;">&gt; data </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> json.</span><span style="color:#D2A8FF;">decode</span><span style="color:#C9D1D9;">(response.body);</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> data.</span><span style="color:#D2A8FF;">map</span><span style="color:#C9D1D9;">((json) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(json)).</span><span style="color:#D2A8FF;">toList</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Failed to load posts&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Network error: $</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// POST \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">createPost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;"> post) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> http.</span><span style="color:#D2A8FF;">post</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">Uri</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">parse</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#79C0FF;">baseUrl</span><span style="color:#A5D6FF;">/posts&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">        headers</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#A5D6FF;">&#39;Content-Type&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;application/json&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">        body</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> json.</span><span style="color:#D2A8FF;">encode</span><span style="color:#C9D1D9;">(post.</span><span style="color:#D2A8FF;">toJson</span><span style="color:#C9D1D9;">()),</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (response.statusCode </span><span style="color:#FF7B72;">==</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">201</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(json.</span><span style="color:#D2A8FF;">decode</span><span style="color:#C9D1D9;">(response.body));</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Failed to create post&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Network error: $</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// PUT \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">updatePost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> id, </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;"> post) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> http.</span><span style="color:#D2A8FF;">put</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">Uri</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">parse</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#79C0FF;">baseUrl</span><span style="color:#A5D6FF;">/posts/$</span><span style="color:#79C0FF;">id</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">        headers</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#A5D6FF;">&#39;Content-Type&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;application/json&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">        body</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> json.</span><span style="color:#D2A8FF;">encode</span><span style="color:#C9D1D9;">(post.</span><span style="color:#D2A8FF;">toJson</span><span style="color:#C9D1D9;">()),</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (response.statusCode </span><span style="color:#FF7B72;">==</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">200</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(json.</span><span style="color:#D2A8FF;">decode</span><span style="color:#C9D1D9;">(response.body));</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Failed to update post&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Network error: $</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// DELETE \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">deletePost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> id) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> http.</span><span style="color:#D2A8FF;">delete</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">Uri</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">parse</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#79C0FF;">baseUrl</span><span style="color:#A5D6FF;">/posts/$</span><span style="color:#79C0FF;">id</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">        headers</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#A5D6FF;">&#39;Content-Type&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;application/json&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (response.statusCode </span><span style="color:#FF7B72;">!=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">204</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Failed to delete post&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Network error: $</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u6570\u636E\u6A21\u578B</span></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">int</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> id;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> title;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> body;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> userId;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">({</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.id,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">required</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.title,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">required</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.body,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">required</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.userId,</span></span>
<span class="line"><span style="color:#C9D1D9;">  });</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">factory</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">Map</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">dynamic</span><span style="color:#C9D1D9;">&gt; json) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      id</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> json[</span><span style="color:#A5D6FF;">&#39;id&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">      title</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> json[</span><span style="color:#A5D6FF;">&#39;title&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">      body</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> json[</span><span style="color:#A5D6FF;">&#39;body&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">      userId</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> json[</span><span style="color:#A5D6FF;">&#39;userId&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">    );</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Map</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">dynamic</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">toJson</span><span style="color:#C9D1D9;">() {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#A5D6FF;">&#39;id&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> id,</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#A5D6FF;">&#39;title&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> title,</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#A5D6FF;">&#39;body&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> body,</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#A5D6FF;">&#39;userId&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> userId,</span></span>
<span class="line"><span style="color:#C9D1D9;">    };</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><h3 id="_2-\u4F7F\u7528-dio-\u5305" tabindex="-1">2. \u4F7F\u7528 Dio \u5305 <a class="header-anchor" href="#_2-\u4F7F\u7528-dio-\u5305" aria-hidden="true">#</a></h3><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;package:dio/dio.dart&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">DioService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Dio</span><span style="color:#C9D1D9;"> _dio </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Dio</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">init</span><span style="color:#C9D1D9;">() {</span></span>
<span class="line"><span style="color:#C9D1D9;">    _dio.options.baseUrl </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;https://jsonplaceholder.typicode.com&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    _dio.options.connectTimeout </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Duration</span><span style="color:#C9D1D9;">(seconds</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">5</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    _dio.options.receiveTimeout </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Duration</span><span style="color:#C9D1D9;">(seconds</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">3</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">// \u6DFB\u52A0\u62E6\u622A\u5668</span></span>
<span class="line"><span style="color:#C9D1D9;">    _dio.interceptors.</span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">LogInterceptor</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      requestBody</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">      responseBody</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    ));</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    _dio.interceptors.</span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">InterceptorsWrapper</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      onRequest</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (options, handler) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// \u6DFB\u52A0\u8BA4\u8BC1\u5934</span></span>
<span class="line"><span style="color:#C9D1D9;">        options.headers[</span><span style="color:#A5D6FF;">&#39;Authorization&#39;</span><span style="color:#C9D1D9;">] </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;Bearer token&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">        handler.</span><span style="color:#D2A8FF;">next</span><span style="color:#C9D1D9;">(options);</span></span>
<span class="line"><span style="color:#C9D1D9;">      },</span></span>
<span class="line"><span style="color:#C9D1D9;">      onResponse</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (response, handler) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// \u5904\u7406\u54CD\u5E94</span></span>
<span class="line"><span style="color:#C9D1D9;">        handler.</span><span style="color:#D2A8FF;">next</span><span style="color:#C9D1D9;">(response);</span></span>
<span class="line"><span style="color:#C9D1D9;">      },</span></span>
<span class="line"><span style="color:#C9D1D9;">      onError</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (error, handler) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// \u5904\u7406\u9519\u8BEF</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#D2A8FF;">print</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Error: \${</span><span style="color:#79C0FF;">error</span><span style="color:#A5D6FF;">.</span><span style="color:#79C0FF;">message</span><span style="color:#A5D6FF;">}&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">        handler.</span><span style="color:#D2A8FF;">next</span><span style="color:#C9D1D9;">(error);</span></span>
<span class="line"><span style="color:#C9D1D9;">      },</span></span>
<span class="line"><span style="color:#C9D1D9;">    ));</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// GET \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt; </span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> _dio.</span><span style="color:#FF7B72;">get</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;/posts&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">dynamic</span><span style="color:#C9D1D9;">&gt; data </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> response.data;</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> data.</span><span style="color:#D2A8FF;">map</span><span style="color:#C9D1D9;">((json) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(json)).</span><span style="color:#D2A8FF;">toList</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">on</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">DioException</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Network error: \${</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">.</span><span style="color:#79C0FF;">message</span><span style="color:#A5D6FF;">}&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// POST \u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">createPost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;"> post) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> _dio.</span><span style="color:#D2A8FF;">post</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#A5D6FF;">&#39;/posts&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">        data</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> post.</span><span style="color:#D2A8FF;">toJson</span><span style="color:#C9D1D9;">(),</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(response.data);</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">on</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">DioException</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Network error: \${</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">.</span><span style="color:#79C0FF;">message</span><span style="color:#A5D6FF;">}&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// \u6587\u4EF6\u4E0A\u4F20</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">uploadFile</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> filePath) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> formData </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">FormData</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromMap</span><span style="color:#C9D1D9;">({</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#A5D6FF;">&#39;file&#39;</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">MultipartFile</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromFile</span><span style="color:#C9D1D9;">(filePath),</span></span>
<span class="line"><span style="color:#C9D1D9;">      });</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> response </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> _dio.</span><span style="color:#D2A8FF;">post</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#A5D6FF;">&#39;/upload&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">        data</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> formData,</span></span>
<span class="line"><span style="color:#C9D1D9;">        onSendProgress</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> sent, </span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> total) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#D2A8FF;">print</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Upload progress: \${(</span><span style="color:#79C0FF;">sent</span><span style="color:#A5D6FF;"> / </span><span style="color:#79C0FF;">total</span><span style="color:#A5D6FF;"> * </span><span style="color:#79C0FF;">100</span><span style="color:#A5D6FF;">).</span><span style="color:#D2A8FF;">toStringAsFixed</span><span style="color:#A5D6FF;">(</span><span style="color:#79C0FF;">0</span><span style="color:#A5D6FF;">)}%&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> response.data[</span><span style="color:#A5D6FF;">&#39;url&#39;</span><span style="color:#C9D1D9;">];</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">on</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">DioException</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Upload error: \${</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">.</span><span style="color:#79C0FF;">message</span><span style="color:#A5D6FF;">}&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h2 id="\u72B6\u6001\u7BA1\u7406\u4E2D\u7684\u7F51\u7EDC\u8BF7\u6C42" tabindex="-1">\u72B6\u6001\u7BA1\u7406\u4E2D\u7684\u7F51\u7EDC\u8BF7\u6C42 <a class="header-anchor" href="#\u72B6\u6001\u7BA1\u7406\u4E2D\u7684\u7F51\u7EDC\u8BF7\u6C42" aria-hidden="true">#</a></h2><h3 id="_1-\u4F7F\u7528-provider" tabindex="-1">1. \u4F7F\u7528 Provider <a class="header-anchor" href="#_1-\u4F7F\u7528-provider" aria-hidden="true">#</a></h3><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">PostProvider</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">extends</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ChangeNotifier</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt; _posts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> [];</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">bool</span><span style="color:#C9D1D9;"> _isLoading </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">false</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">String</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> _error;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#FF7B72;">get</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">posts</span><span style="color:#C9D1D9;"> =&gt; _posts;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">bool</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">get</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">isLoading</span><span style="color:#C9D1D9;"> =&gt; _isLoading;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">String</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">get</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">error</span><span style="color:#C9D1D9;"> =&gt; _error;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">fetchPosts</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    _isLoading </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    _error </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#D2A8FF;">notifyListeners</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _posts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _error </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> e.</span><span style="color:#D2A8FF;">toString</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">finally</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _isLoading </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">false</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">notifyListeners</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">createPost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;"> post) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> newPost </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">createPost</span><span style="color:#C9D1D9;">(post);</span></span>
<span class="line"><span style="color:#C9D1D9;">      _posts.</span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(newPost);</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">notifyListeners</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _error </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> e.</span><span style="color:#D2A8FF;">toString</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">notifyListeners</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">deletePost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> id) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">deletePost</span><span style="color:#C9D1D9;">(id);</span></span>
<span class="line"><span style="color:#C9D1D9;">      _posts.</span><span style="color:#D2A8FF;">removeWhere</span><span style="color:#C9D1D9;">((post) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> post.id </span><span style="color:#FF7B72;">==</span><span style="color:#C9D1D9;"> id);</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">notifyListeners</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _error </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> e.</span><span style="color:#D2A8FF;">toString</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">notifyListeners</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u5728 Widget \u4E2D\u4F7F\u7528</span></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">PostsWidget</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">extends</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">StatelessWidget</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">@override</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Widget</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">build</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">BuildContext</span><span style="color:#C9D1D9;"> context) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Consumer</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">PostProvider</span><span style="color:#C9D1D9;">&gt;(</span></span>
<span class="line"><span style="color:#C9D1D9;">      builder</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (context, provider, child) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (provider.isLoading) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Center</span><span style="color:#C9D1D9;">(child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">CircularProgressIndicator</span><span style="color:#C9D1D9;">());</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (provider.error </span><span style="color:#FF7B72;">!=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Center</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">            child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Column</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">              children</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> [</span></span>
<span class="line"><span style="color:#C9D1D9;">                </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Error: \${</span><span style="color:#79C0FF;">provider</span><span style="color:#A5D6FF;">.</span><span style="color:#79C0FF;">error</span><span style="color:#A5D6FF;">}&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">                </span><span style="color:#79C0FF;">ElevatedButton</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                  onPressed</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> () </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> provider.</span><span style="color:#D2A8FF;">fetchPosts</span><span style="color:#C9D1D9;">(),</span></span>
<span class="line"><span style="color:#C9D1D9;">                  child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Retry&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">                ),</span></span>
<span class="line"><span style="color:#C9D1D9;">              ],</span></span>
<span class="line"><span style="color:#C9D1D9;">            ),</span></span>
<span class="line"><span style="color:#C9D1D9;">          );</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ListView</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">builder</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">          itemCount</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> provider.posts.length,</span></span>
<span class="line"><span style="color:#C9D1D9;">          itemBuilder</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (context, index) {</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> post </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> provider.posts[index];</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ListTile</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">              title</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(post.title),</span></span>
<span class="line"><span style="color:#C9D1D9;">              subtitle</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(post.body),</span></span>
<span class="line"><span style="color:#C9D1D9;">              trailing</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">IconButton</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                icon</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Icon</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">Icons</span><span style="color:#C9D1D9;">.delete),</span></span>
<span class="line"><span style="color:#C9D1D9;">                onPressed</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> () </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> provider.</span><span style="color:#D2A8FF;">deletePost</span><span style="color:#C9D1D9;">(post.id</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">              ),</span></span>
<span class="line"><span style="color:#C9D1D9;">            );</span></span>
<span class="line"><span style="color:#C9D1D9;">          },</span></span>
<span class="line"><span style="color:#C9D1D9;">        );</span></span>
<span class="line"><span style="color:#C9D1D9;">      },</span></span>
<span class="line"><span style="color:#C9D1D9;">    );</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h3 id="_2-\u4F7F\u7528-riverpod" tabindex="-1">2. \u4F7F\u7528 Riverpod <a class="header-anchor" href="#_2-\u4F7F\u7528-riverpod" aria-hidden="true">#</a></h3><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> postsProvider </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">FutureProvider</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt;((ref) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> postProvider </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">StateNotifierProvider</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">PostNotifier</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt;&gt;((ref) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">PostNotifier</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">PostNotifier</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">extends</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">StateNotifier</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt;&gt; {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">PostNotifier</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">super</span><span style="color:#C9D1D9;">(</span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">loading</span><span style="color:#C9D1D9;">());</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">fetchPosts</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    state </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">loading</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> posts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      state </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">data</span><span style="color:#C9D1D9;">(posts);</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (error, stackTrace) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      state </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">error</span><span style="color:#C9D1D9;">(error, stackTrace);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">createPost</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;"> post) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> newPost </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">createPost</span><span style="color:#C9D1D9;">(post);</span></span>
<span class="line"><span style="color:#C9D1D9;">      state.</span><span style="color:#D2A8FF;">whenData</span><span style="color:#C9D1D9;">((posts) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        state </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">data</span><span style="color:#C9D1D9;">([...posts, newPost]);</span></span>
<span class="line"><span style="color:#C9D1D9;">      });</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (error, stackTrace) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      state </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">AsyncValue</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">error</span><span style="color:#C9D1D9;">(error, stackTrace);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u5728 Widget \u4E2D\u4F7F\u7528</span></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">PostsWidget</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">extends</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ConsumerWidget</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">@override</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Widget</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">build</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">BuildContext</span><span style="color:#C9D1D9;"> context, </span><span style="color:#79C0FF;">WidgetRef</span><span style="color:#C9D1D9;"> ref) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> postsAsync </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> ref.</span><span style="color:#D2A8FF;">watch</span><span style="color:#C9D1D9;">(postsProvider);</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> postsAsync.</span><span style="color:#D2A8FF;">when</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      data</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (posts) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ListView</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">builder</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        itemCount</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> posts.length,</span></span>
<span class="line"><span style="color:#C9D1D9;">        itemBuilder</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (context, index) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> post </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> posts[index];</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ListTile</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">            title</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(post.title),</span></span>
<span class="line"><span style="color:#C9D1D9;">            subtitle</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(post.body),</span></span>
<span class="line"><span style="color:#C9D1D9;">          );</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">      ),</span></span>
<span class="line"><span style="color:#C9D1D9;">      loading</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> () </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Center</span><span style="color:#C9D1D9;">(child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">CircularProgressIndicator</span><span style="color:#C9D1D9;">()),</span></span>
<span class="line"><span style="color:#C9D1D9;">      error</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (error, stack) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Center</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Column</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">          children</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> [</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Error: $</span><span style="color:#79C0FF;">error</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#79C0FF;">ElevatedButton</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">              onPressed</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> () </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> ref.</span><span style="color:#D2A8FF;">refresh</span><span style="color:#C9D1D9;">(postsProvider),</span></span>
<span class="line"><span style="color:#C9D1D9;">              child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Retry&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">            ),</span></span>
<span class="line"><span style="color:#C9D1D9;">          ],</span></span>
<span class="line"><span style="color:#C9D1D9;">        ),</span></span>
<span class="line"><span style="color:#C9D1D9;">      ),</span></span>
<span class="line"><span style="color:#C9D1D9;">    );</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h2 id="websocket-\u8FDE\u63A5" tabindex="-1">WebSocket \u8FDE\u63A5 <a class="header-anchor" href="#websocket-\u8FDE\u63A5" aria-hidden="true">#</a></h2><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;dart:io&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">WebSocketService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">WebSocket</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> _socket;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">StreamController</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">&gt;</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> _messageController;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Stream</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#FF7B72;">get</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">messageStream</span><span style="color:#C9D1D9;"> =&gt; _messageController</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">.stream;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">connect</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> url) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _socket </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">WebSocket</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">connect</span><span style="color:#C9D1D9;">(url);</span></span>
<span class="line"><span style="color:#C9D1D9;">      _messageController </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">StreamController</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">&gt;();</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span></span>
<span class="line"><span style="color:#C9D1D9;">      _socket</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">listen</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        (data) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          _messageController</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(data.</span><span style="color:#D2A8FF;">toString</span><span style="color:#C9D1D9;">());</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">        onError</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (error) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#D2A8FF;">print</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;WebSocket error: $</span><span style="color:#79C0FF;">error</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">        onDone</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> () {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#D2A8FF;">print</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;WebSocket connection closed&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">        },</span></span>
<span class="line"><span style="color:#C9D1D9;">      );</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Failed to connect: $</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">sendMessage</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> message) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (_socket </span><span style="color:#FF7B72;">!=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _socket</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(message);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">disconnect</span><span style="color:#C9D1D9;">() {</span></span>
<span class="line"><span style="color:#C9D1D9;">    _socket</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">close</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    _messageController</span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">close</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u5728 Widget \u4E2D\u4F7F\u7528</span></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ChatWidget</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">extends</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">StatefulWidget</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">@override</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">_ChatWidgetState</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">createState</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">_ChatWidgetState</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">_ChatWidgetState</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">extends</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">State</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">ChatWidget</span><span style="color:#C9D1D9;">&gt; {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">WebSocketService</span><span style="color:#C9D1D9;"> _webSocketService </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">WebSocketService</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">TextEditingController</span><span style="color:#C9D1D9;"> _messageController </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">TextEditingController</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;">&gt; _messages </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> [];</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">@override</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">initState</span><span style="color:#C9D1D9;">() {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">super</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">initState</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#D2A8FF;">_connectToWebSocket</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">_connectToWebSocket</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> _webSocketService.</span><span style="color:#D2A8FF;">connect</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;ws://localhost:8080&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">      _webSocketService.messageStream.</span><span style="color:#D2A8FF;">listen</span><span style="color:#C9D1D9;">((message) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#D2A8FF;">setState</span><span style="color:#C9D1D9;">(() {</span></span>
<span class="line"><span style="color:#C9D1D9;">          _messages.</span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(message);</span></span>
<span class="line"><span style="color:#C9D1D9;">        });</span></span>
<span class="line"><span style="color:#C9D1D9;">      });</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">print</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Connection error: $</span><span style="color:#79C0FF;">e</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">_sendMessage</span><span style="color:#C9D1D9;">() {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (_messageController.text.isNotEmpty) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      _webSocketService.</span><span style="color:#D2A8FF;">sendMessage</span><span style="color:#C9D1D9;">(_messageController.text);</span></span>
<span class="line"><span style="color:#C9D1D9;">      _messageController.</span><span style="color:#D2A8FF;">clear</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">@override</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">dispose</span><span style="color:#C9D1D9;">() {</span></span>
<span class="line"><span style="color:#C9D1D9;">    _webSocketService.</span><span style="color:#D2A8FF;">disconnect</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    _messageController.</span><span style="color:#D2A8FF;">dispose</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">super</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">dispose</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">@override</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">Widget</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">build</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">BuildContext</span><span style="color:#C9D1D9;"> context) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Column</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      children</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> [</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">Expanded</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">          child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ListView</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">builder</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">            itemCount</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> _messages.length,</span></span>
<span class="line"><span style="color:#C9D1D9;">            itemBuilder</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> (context, index) {</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ListTile</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                title</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(_messages[index]),</span></span>
<span class="line"><span style="color:#C9D1D9;">              );</span></span>
<span class="line"><span style="color:#C9D1D9;">            },</span></span>
<span class="line"><span style="color:#C9D1D9;">          ),</span></span>
<span class="line"><span style="color:#C9D1D9;">        ),</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">Padding</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">          padding</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">EdgeInsets</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">all</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">8.0</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">          child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Row</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">            children</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> [</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#79C0FF;">Expanded</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">TextField</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                  controller</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> _messageController,</span></span>
<span class="line"><span style="color:#C9D1D9;">                  decoration</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">InputDecoration</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                    hintText</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;Enter message&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">                    border</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">OutlineInputBorder</span><span style="color:#C9D1D9;">(),</span></span>
<span class="line"><span style="color:#C9D1D9;">                  ),</span></span>
<span class="line"><span style="color:#C9D1D9;">                ),</span></span>
<span class="line"><span style="color:#C9D1D9;">              ),</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#79C0FF;">SizedBox</span><span style="color:#C9D1D9;">(width</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">8.0</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#79C0FF;">ElevatedButton</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">                onPressed</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> _sendMessage,</span></span>
<span class="line"><span style="color:#C9D1D9;">                child</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Text</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Send&#39;</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">              ),</span></span>
<span class="line"><span style="color:#C9D1D9;">            ],</span></span>
<span class="line"><span style="color:#C9D1D9;">          ),</span></span>
<span class="line"><span style="color:#C9D1D9;">        ),</span></span>
<span class="line"><span style="color:#C9D1D9;">      ],</span></span>
<span class="line"><span style="color:#C9D1D9;">    );</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br></div></div><h2 id="\u7F13\u5B58\u548C\u79BB\u7EBF\u652F\u6301" tabindex="-1">\u7F13\u5B58\u548C\u79BB\u7EBF\u652F\u6301 <a class="header-anchor" href="#\u7F13\u5B58\u548C\u79BB\u7EBF\u652F\u6301" aria-hidden="true">#</a></h2><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;package:shared_preferences/shared_preferences.dart&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">CacheService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">String</span><span style="color:#C9D1D9;"> _postsKey </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;cached_posts&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// \u7F13\u5B58\u6570\u636E</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">cachePosts</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt; posts) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> prefs </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">SharedPreferences</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getInstance</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> postsJson </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> posts.</span><span style="color:#D2A8FF;">map</span><span style="color:#C9D1D9;">((post) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> post.</span><span style="color:#D2A8FF;">toJson</span><span style="color:#C9D1D9;">()).</span><span style="color:#D2A8FF;">toList</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> prefs.</span><span style="color:#D2A8FF;">setString</span><span style="color:#C9D1D9;">(_postsKey, json.</span><span style="color:#D2A8FF;">encode</span><span style="color:#C9D1D9;">(postsJson));</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// \u83B7\u53D6\u7F13\u5B58\u6570\u636E</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;?&gt; </span><span style="color:#D2A8FF;">getCachedPosts</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> prefs </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">SharedPreferences</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getInstance</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> postsString </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> prefs.</span><span style="color:#D2A8FF;">getString</span><span style="color:#C9D1D9;">(_postsKey);</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (postsString </span><span style="color:#FF7B72;">!=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">dynamic</span><span style="color:#C9D1D9;">&gt; postsJson </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> json.</span><span style="color:#D2A8FF;">decode</span><span style="color:#C9D1D9;">(postsString);</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> postsJson.</span><span style="color:#D2A8FF;">map</span><span style="color:#C9D1D9;">((json) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">fromJson</span><span style="color:#C9D1D9;">(json)).</span><span style="color:#D2A8FF;">toList</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// \u6E05\u9664\u7F13\u5B58</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FF7B72;">void</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">clearCache</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> prefs </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">SharedPreferences</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getInstance</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> prefs.</span><span style="color:#D2A8FF;">remove</span><span style="color:#C9D1D9;">(_postsKey);</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u5E26\u7F13\u5B58\u7684\u7F51\u7EDC\u670D\u52A1</span></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">CachedHttpService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt; </span><span style="color:#D2A8FF;">getPostsWithCache</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// \u5C1D\u8BD5\u4ECE\u7F51\u7EDC\u83B7\u53D6\u6570\u636E</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> posts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// \u7F13\u5B58\u6570\u636E</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">CacheService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">cachePosts</span><span style="color:#C9D1D9;">(posts);</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> posts;</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// \u7F51\u7EDC\u5931\u8D25\uFF0C\u5C1D\u8BD5\u4ECE\u7F13\u5B58\u83B7\u53D6</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">final</span><span style="color:#C9D1D9;"> cachedPosts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">CacheService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getCachedPosts</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (cachedPosts </span><span style="color:#FF7B72;">!=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> cachedPosts;</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;No data available&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h2 id="\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236" tabindex="-1">\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236 <a class="header-anchor" href="#\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236" aria-hidden="true">#</a></h2><div class="language-dart line-numbers-mode"><button class="copy"></button><span class="lang">dart</span><pre><code><span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">RetryService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">T</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#D2A8FF;">retry</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">T</span><span style="color:#C9D1D9;">&gt;(</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">T</span><span style="color:#C9D1D9;">&gt; </span><span style="color:#79C0FF;">Function</span><span style="color:#C9D1D9;">() operation, {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> maxAttempts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">3</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">Duration</span><span style="color:#C9D1D9;"> delay </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Duration</span><span style="color:#C9D1D9;">(seconds</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  }) </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#79C0FF;">int</span><span style="color:#C9D1D9;"> attempts </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">while</span><span style="color:#C9D1D9;"> (attempts </span><span style="color:#FF7B72;">&lt;</span><span style="color:#C9D1D9;"> maxAttempts) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">operation</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        attempts</span><span style="color:#FF7B72;">++</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (attempts </span><span style="color:#FF7B72;">&gt;=</span><span style="color:#C9D1D9;"> maxAttempts) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> e;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">delayed</span><span style="color:#C9D1D9;">(delay </span><span style="color:#FF7B72;">*</span><span style="color:#C9D1D9;"> attempts);</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">throw</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Exception</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;Max retry attempts reached&#39;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u4F7F\u7528\u91CD\u8BD5\u673A\u5236</span></span>
<span class="line"><span style="color:#FF7B72;">class</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">ResilientHttpService</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">static</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Future</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">List</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">Post</span><span style="color:#C9D1D9;">&gt;&gt; </span><span style="color:#D2A8FF;">getPostsWithRetry</span><span style="color:#C9D1D9;">() </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">RetryService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">retry</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      () </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">HttpService</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getPosts</span><span style="color:#C9D1D9;">(),</span></span>
<span class="line"><span style="color:#C9D1D9;">      maxAttempts</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">3</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">      delay</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">Duration</span><span style="color:#C9D1D9;">(seconds</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">2</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">    );</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>Flutter \u7F51\u7EDC\u8BF7\u6C42\u7684\u7279\u70B9\uFF1A</p><ul><li><strong>\u591A\u79CD\u9009\u62E9</strong>: http\u3001dio\u3001WebSocket \u7B49</li><li><strong>\u7C7B\u578B\u5B89\u5168</strong>: \u652F\u6301\u5F3A\u7C7B\u578B\u6570\u636E\u6A21\u578B</li><li><strong>\u72B6\u6001\u7BA1\u7406</strong>: \u4E0E Provider\u3001Riverpod \u7B49\u96C6\u6210</li><li><strong>\u7F13\u5B58\u652F\u6301</strong>: \u79BB\u7EBF\u6570\u636E\u8BBF\u95EE</li><li><strong>\u9519\u8BEF\u5904\u7406</strong>: \u5B8C\u5584\u7684\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5\u673A\u5236</li></ul>`,21),e=[o];function r(c,t,D,y,F,i){return a(),n("div",null,e)}const u=s(p,[["render",r]]);export{b as __pageData,u as default};
